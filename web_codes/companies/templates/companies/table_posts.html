{% extends "recruit_manager/table_basic.html" %}
{% load static %}
{% block content %}

<form name='filter_form'>
    {% csrf_token %}
    <div class="row col-md-24 register-form">
      <div class="col-md-3 form-group">
        <label> 公司名称 </label>
        <input type="text" name="company_name" id="company_name_id" placeholder="公司名" value="">
      </div>
      <div class="col-md-3 form-group">
        <label> 部门名称 </label>
        <input type="text" name="department" id="department_id" placeholder="部门名称" value="">
      </div>
      <div class="col-md-3 form-group">
        <label> 岗位名称 </label>
        <input type="text" name="post" id="post_id" placeholder="岗位名称" value="">
      </div>
    </div>
    <div class="row col-md-24">
      <div class="col-md-3 form-group">
        <button type='submit' class="btn btn-primary" id='post_button_id'>确认发布</button>
      </div>
    </div>
</form>

<div class="table-responsive">
  <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
    <thead>
      <tr>
        <th>ID</th>
        <th>*Company</th>
        <th>*Department</th>
        <th>*Name</th>
        <th>*JD</th>
      </tr>
    </thead>
  </table>
</div>
{% endblock %}

{% block extra_js %}
<script>
 $(document).ready(function() {
   var selected = [];
   var table = $('#dataTable').DataTable({
     "processing": true,
     "serverSide": true,

     "ajax": {
       "url": "/api/posts/",
       "type": "GET",
     },

     "rowCallback": function(row, data) {
       if ($.inArray(data.DT_RowId.toString(), selected) !== -1 ) {
         $(row).addClass('selected');
       }

     },

     "columns": [
       {"data": "id"},
       {"data": "department.company.name"},
       {"data": "department.name"},
       {"data": "name"},
       {"data": "description"},
     ],
   });

   $('#dataTable tbody').on('click', 'tr', function() {
     var id = this.id;
     var index = $.inArray(id, selected);

     if ( index === -1 ) {
       selected.push(id);
     } else {
       selected.splice(index, 1);
     }

     $(this).toggleClass('selected');
   });

   $('#id_b_submit').on('click', function() {
     console.log(selected);
     localStorage['post'] = selected[0];
   });
   $('#post_button_id').on('click', function() {
     postAjaxSubmit()
     table.draw()
   });
 });
 function postAjaxSubmit() {
   $.ajax({
     "url": "/post/post/update",
     "type":"POST",
     "data": {
       "company_name" : $('#company_name_id').val(),
       "department_name" : $('#department_id').val(),
       "post_name" : $('#post_id').val()
     },
   });
 }
</script>
{% endblock%}
