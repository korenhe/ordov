{% extends "recruit_manager/table_basic.html" %}
{% load static %}
{% block content %}

<form name='filter_form' id="post_filter_form">
    {% csrf_token %}
    <div class="row col-md-24 register-form">
      <div class="col-md-3 form-group">
        <label> 公司名称 </label>
        <input type="text" name="company_name" id="company_name_id" placeholder="公司名" value="">
      </div>
      <div class="col-md-3 form-group">
        <label> 部门名称 </label>
        <input type="text" name="department_name" id="department_id" placeholder="部门名称" value="">
      </div>
      <div class="col-md-3 form-group">
        <label> 岗位名称 </label>
        <input type="text" name="post_name" id="post_id" placeholder="岗位名称" value="">
      </div>
    </div>

    <div class="row col-md-24 register-form">
      <h6> 过滤条件 </h6>
    </div>

    <div class="row col-md-24 register-form">
      <div class="col-md-3 form-group">
        <label> 最小年龄 </label>
        <input type="text" name="min_age_id" placeholder="年龄" value="">
      </div>
      <div class="col-md-3 form-group">
        <label> 月薪 </label>
        <input type="text" name="min_salary" placeholder="元/月" value="">
      </div>
      <div class="col-md-3 form-group">
        <label> 最低学历 </label>
		<select class="form-control" name="min_degree" id="min_degree_id">
			<option>不限</option>
			<option>初中</option>
			<option>高中</option>
			<option>本科</option>
			<option>硕士</option>
			<option>博士</option>
		</select>
      </div>
	</div>

    <div class="row col-md-24 register-form">
      <h6> 工作地点 </h6>
    </div>

    <div class="row col-md-24 register-form">
      <div class="col-md-3 form-group">
        <input type="text" name="working_place_province" placeholder="省" value="">
      </div>
      <div class="col-md-3 form-group">
        <input type="text" name="working_place_city" placeholder="市" value="">
      </div>
      <div class="col-md-3 form-group">
        <input type="text" name="working_place_district" placeholder="区/县" value="">
      </div>
   </div>

    <div class="row col-md-24">
      <div class="col-md-3 form-group">
        <button type='submit' class="btn btn-primary" id='post_button_id'>确认发布</button>
      </div>
    </div>
</form>

<div class="table-responsive">
  <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
    <thead>
      <tr>
        <th>ID</th>
        <th>*Company</th>
        <th>*Department</th>
        <th>*Name</th>
        <th>*JD</th>
      </tr>
    </thead>
  </table>
</div>
{% endblock %}

{% block extra_js %}
<script>
 $(document).ready(function() {
   var selected = [];
   var table = $('#dataTable').DataTable({
     "processing": true,
     "serverSide": true,

     "ajax": {
       "url": "/api/posts/",
       "type": "GET",
     },

     "rowCallback": function(row, data) {
       if ($.inArray(data.DT_RowId.toString(), selected) !== -1 ) {
         $(row).addClass('selected');
       }

     },

     "columns": [
       {"data": "id"},
       {"data": "department.company.name"},
       {"data": "department.name"},
       {"data": "name"},
       {"data": "description"},
     ],
   });

   $('#dataTable tbody').on('click', 'tr', function() {
     var id = this.id;
     var index = $.inArray(id, selected);

     if ( index === -1 ) {
       selected.push(id);
     } else {
       selected.splice(index, 1);
     }

     $(this).toggleClass('selected');
   });

   $('#id_b_submit').on('click', function() {
     console.log(selected);
     localStorage['post'] = selected[0];
   });
   $('#post_button_id').on('click', function() {
     postAjaxSubmit()
     table.draw()
   });
 });
 function postAjaxSubmit() {
   $.ajax({
     "url": "/post/post/update/",
     "type":"POST",
	 "data":$('#post_filter_form').serialize(),
   });
 }
</script>
{% endblock%}
